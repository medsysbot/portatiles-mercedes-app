{% extends 'base_adminlte.html' %}
{% block title %}Mis Comprobantes{% endblock %}
{% block description %}Listado de comprobantes subidos{% endblock %}

{% block body %}
<div class="content-wrapper" style="background: url('/static/imagenes/fondo-panel.png') no-repeat center center fixed; background-size: cover; min-height: 100vh;">
  <div class="container mt-4">
    <h2>Mis Comprobantes de Pago</h2>
    <div class="text-right mb-3">
      <button id="btnEliminarComprobantes" class="btn btn-danger" disabled>Eliminar seleccionados</button>
    </div>
    <div class="table-responsive bg-light p-3">
      <table id="tablaComprobantes" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th></th>
            <th>Nombre cliente</th>
            <th>DNI / CUIT / CUIL</th>
            <th>NÃºmero factura</th>
            <th>Comprobante</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
  <script src="/static/js/cliente_panel.js"></script>
  <script>
    // Ejemplo para cargar comprobantes usando tu API y DataTables
    document.addEventListener('DOMContentLoaded', async () => {
      const usuario = JSON.parse(localStorage.getItem("usuario_obj") || "{}");
      const dni = usuario.dni_quit_quill || usuario.dni_cuit_cuil || "";
      if (!dni) return;
      const res = await fetchConAuth(`/clientes/comprobantes_api?dni_cuit_cuil=${encodeURIComponent(dni)}`);
      const comprobantes = res ? await res.json() : [];
      // Rellena la tabla usando DataTables
      $('#tablaComprobantes').DataTable({
        data: comprobantes,
        destroy: true,
        columns: [
          { data: null, defaultContent: '', orderable: false },
          { data: 'nombre_cliente', defaultContent: '-' },
          { data: 'dni_cuit_cuil', defaultContent: '-' },
          { data: 'numero_factura', defaultContent: '-' },
          { data: 'comprobante_url', render: data => data ? `<a href="${data}" target="_blank">Ver</a>` : '-', defaultContent: '-' },
          { data: 'fecha', defaultContent: '-' }
        ]
      });
    });
  </script>
{% endblock %}
