{% extends 'panel_admin.html' %}
{% block title %}Clientes{% endblock %}
{% block content %}
<h2 class="mb-3 mt-0">Administración de clientes</h2><!-- Título alineado arriba según estándar visual de Portátiles Mercedes -->
<div class="subtitulo-portatiles">
    Lo tradicional, hecho inteligente
</div><!-- Subtítulo institucional agregado según estándar visual Portátiles Mercedes -->

<form method="get" class="form-inline mb-3">
  <input type="text" id="busquedaCliente" name="q" class="form-control mr-2" placeholder="Nombre, DNI o email" value="{{ request.query_params.get('q','') }}">
  <select id="estadoFiltro" name="estado" class="form-control mr-2">
    <option value="">Todos</option>
    <option value="activo" {% if request.query_params.get('estado')=='activo' %}selected{% endif %}>Activo</option>
    <option value="inactivo" {% if request.query_params.get('estado')=='inactivo' %}selected{% endif %}>Inactivo</option>
  </select>
  <button type="submit" class="btn btn-primary">Buscar</button>
</form>

<a href="/admin/clientes/nuevo" class="btn btn-success mb-3">Agregar cliente</a>

<div class="table-responsive bg-light p-3">
  <table id="tablaClientes" class="table table-striped table-bordered" style="min-width: 800px;">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Apellido</th>
      <th>DNI</th>
      <th>Email</th>
      <th>Teléfono</th>
      <th>Estado</th>
      <th>Fecha alta</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for c in clientes %}
    <tr>
      <td>{{ c.nombre }}</td>
      <td>{{ c.apellido }}</td>
      <td>{{ c.dni }}</td>
      <td>{{ c.email }}</td>
      <td>{{ c.telefono }}</td>
      <td>{{ c.estado }}</td>
      <td>{{ c.fecha_alta }}</td>
      <td>
        <a href="/admin/clientes/{{ c.dni }}/editar" class="btn btn-sm btn-primary">Editar</a>
        <form method="post" action="/admin/clientes/{{ c.dni }}/eliminar" style="display:inline" onsubmit="return confirm('Eliminar cliente?');">
          <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>

<div class="mt-3">
  {% if pagina_actual > 1 %}
    <a href="?page={{ pagina_actual -1 }}{% if query_str %}&{{ query_str }}{% endif %}" class="btn btn-default">Anterior</a>
  {% endif %}
  {% if hay_mas %}
    <a href="?page={{ pagina_actual +1 }}{% if query_str %}&{{ query_str }}{% endif %}" class="btn btn-default">Siguiente</a>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="/clientes_admin.js"></script>
{% endblock %}
